#!/bin/bash
set -euxo pipefail

brew update

formulas=( \
  wget \
  curl \
  git \
  hub \
  jq \
  zsh \
  vim \
  tmux \
  htop \
  redis \
  go \
  scala sbt \
  rbenv \
  nodenv \
  plenv perl-build \
  pyenv \
  haskell-stack \
  rust \
  shellcheck \
  envchain \
  sshuttle\
  ctags \
  coreutils \
  gnuplot \
  awscli \
  \
  mackerelio/mackerel-agent/mackerel-agent \
  mackerelio/mackerel-agent/mkr \
  \
  itchyny/tap/git-branch-name \
  itchyny/tap/fillin \
  itchyny/tap/miv \
  itchyny/tap/qhs \
  itchyny/tap/rexdep \
  itchyny/tap/gojo \
  itchyny/tap/gojq \
  itchyny/tap/mkrg \
  itchyny/tap/mackerel-plugin-battery \
  itchyny/tap/mackerel-plugin-dice \
  itchyny/tap/formulate \
  \
  Songmu/tap/blogsync \
)

if ! brew cask ls --versions "adoptopenjdk"; then
  brew cask install --no-quarantine "adoptopenjdk" # required for scala
fi

if ! command -v node >/dev/null 2>&1; then
  tools/brew-install "node"
fi

for formula in "${formulas[@]}"; do
  tools/brew-install "$formula"
done

if command -v miv >/dev/null 2>&1; then
  miv install
  cd "$(miv path vimproc)" && make
fi

eval "$(plenv init -)"
eval "$(pyenv init -)"
eval "$(rbenv init -)"
eval "$(nodenv init -)"
